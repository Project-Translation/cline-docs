# 使用 Cline 从零构建自定义 MCP 服务器：全面指南

本指南提供了使用 Cline 的强大 AI 功能从零构建自定义 MCP（模型上下文协议）服务器的全面教程。本例将以构建“GitHub 助手服务器”为例，说明整个过程。

## 理解 MCP 以及 Cline 在构建服务器中的角色

### 什么是 MCP？

模型上下文协议（MCP）是大语言模型（LLM）如 Claude 与外部工具和数据之间的桥梁。MCP 包含两个关键组件：

-   **MCP 主机：** 这些是与 LLM 集成的应用程序，例如 Cline、Claude Desktop 等。
-   **MCP 服务器：** 这些是专门设计的小程序，旨在通过 MCP 向 LLM 暴露数据或特定功能。

当您拥有符合 MCP 的聊天界面（如 Claude Desktop）时，这种设置非常有益，因为它可以利用这些服务器访问信息并执行操作。

### 为什么使用 Cline 创建 MCP 服务器？

Cline 通过利用其 AI 能力简化了构建和集成 MCP 服务器的过程：

-   **理解自然语言指令：** 您可以以自然的方式与 Cline 交流，使开发过程直观且用户友好。
-   **克隆仓库：** Cline 可以直接从 GitHub 克隆现有的 MCP 服务器仓库，简化了使用预构建服务器的过程。
-   **构建服务器：** 一旦必要的代码就位，Cline 可以执行类似 `npm run build` 的命令，编译并准备好服务器以供使用。
-   **处理配置：** Cline 管理 MCP 服务器所需的配置文件，包括将新服务器添加到 `cline_mcp_settings.json` 文件中。
-   **协助故障排除：** 如果在开发或测试过程中出现错误，Cline 可以帮助识别原因并提出解决方案，使调试更加容易。

## 使用 Cline 构建 GitHub 助手服务器：分步指南

本节展示如何使用 Cline 创建一个 GitHub 助手服务器。该服务器将能够与 GitHub 数据交互并执行有用的操作：

### 1. 定义目标和初始需求

首先，您需要向 Cline 清楚地传达服务器的目的和功能：

-   **服务器目标：** 告知 Cline 您想构建一个“GitHub 助手服务器”。指定该服务器将与 GitHub 数据交互，并可能提及您感兴趣的数据类型，如问题、拉取请求和用户资料。
-   **访问要求：** 让 Cline 知道您需要访问 GitHub API。解释这可能需要一个个人访问令牌（GITHUB_TOKEN）进行身份验证。
-   **数据具体性（可选）：** 您可以选择性地告诉 Cline 您希望从 GitHub 提取的特定数据字段，但这也可以在稍后定义服务器工具时确定。 

### 2. Cline 启动项目设置

根据您的指令，Cline 开始项目设置过程：
-   **项目结构：** Cline 可能会询问您服务器的名称。之后，它会使用 MCP 的 `create-server` 工具为您的 GitHub 助手服务器生成基本的项目结构。这通常包括创建一个新目录，其中包含 `package.json`、`tsconfig.json` 等必要文件，以及用于存放 TypeScript 代码的 `src` 文件夹。\
-   **代码生成：** Cline 会为您的服务器生成初始代码，包括：
    -   **文件处理工具：** 帮助读取和写入文件的函数，常用于存储数据或日志。\
    -   **GitHub API 客户端：** 与 GitHub API 交互的代码，通常使用类似 `@octokit/graphql` 的库。Cline 可能会询问您的 GitHub 用户名或您希望操作的仓库。\
    -   **核心服务器逻辑：** 处理来自 Cline 的请求并将其路由到适当函数的基本框架，由 MCP 定义。\
-   **依赖管理：** Cline 会分析代码并识别所需的依赖项，将其添加到 `package.json` 文件中。例如，与 GitHub API 交互可能需要类似 `@octokit/graphql`、`graphql`、`axios` 等包。\
-   **依赖安装：** Cline 会执行 `npm install` 命令，下载并安装 `package.json` 中列出的依赖项，确保您的服务器具备正常运行所需的所有库。\
-   **路径校正：** 在开发过程中，您可能会移动文件或目录。Cline 能够智能识别这些更改，并自动更新代码中的文件路径以保持一致性。\
-   **配置：** Cline 会修改 `cline_mcp_settings.json` 文件以添加您的新 GitHub 助手服务器。这将包括：
    -   **服务器启动命令：** Cline 会添加启动服务器的适当命令（例如 `npm run start` 或类似命令）。
    -   **环境变量：** Cline 会添加所需的 `GITHUB_TOKEN` 变量。Cline 可能会询问您的 GitHub 个人访问令牌，或者指导您将其安全地存储在单独的环境文件中。\
-   **进度文档：** 在整个过程中，Cline 会不断更新“记忆库”文件。这些文件记录项目的进展，突出显示已完成的任务、正在进行的任务和待处理的任务。

### 3. 测试 GitHub 助手服务器

一旦 Cline 完成设置和配置，您就可以测试服务器的功能：

-   **使用服务器工具：** Cline 会在您的服务器中创建各种“工具”，代表操作或数据获取功能。为了测试，您可以指示 Cline 使用特定工具。以下是与 GitHub 相关的示例：
    -   **`get_issues`：** 要测试获取问题，您可以对 Cline 说：“Cline，使用 GitHub 助手服务器的 `get_issues` 工具，显示 'cline/cline' 仓库中的开放问题。”Cline 随后会执行此工具并向您展示结果。
    -   **`get_pull_requests`：** 要测试拉取请求的获取，您可以要求 Cline “使用 `get_pull_requests` 工具，显示 'facebook/react' 仓库过去一个月的已合并拉取请求。”Cline 会执行此工具，使用您的 `GITHUB_TOKEN` 访问 GitHub API，并显示请求的数据。\
-   **提供必要信息：** Cline 可能会提示您提供执行工具所需的额外信息，例如仓库名称、具体日期范围或其他筛选条件。
-   **Cline 执行工具：** Cline 会处理与 GitHub API 的通信，获取请求的数据，并以清晰易懂的格式呈现。

### 4. 优化服务器并添加更多功能

开发通常是迭代的。在使用 GitHub 助手服务器的过程中，您会发现需要添加新功能或改进现有功能。Cline 可以协助您进行这一持续的过程：

-   **与 Cline 讨论：** 与 Cline 讨论您对新工具或改进的想法。例如，您可能希望有一个工具来 `create_issue` 或 `get_user_profile`。与 Cline 讨论这些工具所需的输入和输出。
-   **代码优化：** Cline 可以帮助您编写新功能所需的代码。Cline 可以生成代码片段、建议最佳实践，并帮助您调试出现的问题。
-   **测试新功能：** 在添加新工具或功能后，您可以再次使用 Cline 进行测试，确保它们按预期工作并与服务器的其他部分良好集成。
-   **与其他工具集成：** 您可能希望将 GitHub 助手服务器与其他工具集成。例如，在“github-cline-mcp”源代码中，Cline 协助将服务器与 Notion 集成，以创建一个动态仪表板，追踪 GitHub 活动。
-   **项目结构：** Cline 可能会询问您服务器的名称。之后，它会使用 MCP 的 `create-server` 工具为您的 GitHub 助手服务器生成基本的项目结构。这通常包括创建一个新目录，其中包含 `package.json`、`tsconfig.json` 等必要文件，以及用于存放 TypeScript 代码的 `src` 文件夹。\
-   **代码生成：** Cline 会为您的服务器生成初始代码，包括：
    -   **文件处理工具：** 帮助读取和写入文件的函数，常用于存储数据或日志。\
    -   **GitHub API 客户端：** 与 GitHub API 交互的代码，通常使用类似 `@octokit/graphql` 的库。Cline 可能会询问您的 GitHub 用户名或您希望操作的仓库。\
    -   **核心服务器逻辑：** 处理来自 Cline 的请求并将其路由到适当函数的基本框架，由 MCP 定义。\
-   **依赖管理：** Cline 会分析代码并识别所需的依赖项，将其添加到 `package.json` 文件中。例如，与 GitHub API 交互可能需要类似 `@octokit/graphql`、`graphql`、`axios` 等包。\
-   **依赖安装：** Cline 会执行 `npm install` 命令，下载并安装 `package.json` 中列出的依赖项，确保您的服务器具备正常运行所需的所有库。\
-   **路径校正：** 在开发过程中，您可能会移动文件或目录。Cline 能够智能识别这些更改，并自动更新代码中的文件路径以保持一致性。\
-   **配置：** Cline 会修改 `cline_mcp_settings.json` 文件以添加您的新 GitHub 助手服务器。这将包括：
    -   **服务器启动命令：** Cline 会添加启动服务器的适当命令（例如 `npm run start` 或类似命令）。
    -   **环境变量：** Cline 会添加所需的 `GITHUB_TOKEN` 变量。Cline 可能会询问您的 GitHub 个人访问令牌，或者指导您将其安全地存储在单独的环境文件中。\
-   **进度文档：** 在整个过程中，Cline 会不断更新“记忆库”文件。这些文件记录项目的进展，突出显示已完成的任务、正在进行的任务和待处理的任务。

### 3. 测试 GitHub 助手服务器

一旦 Cline 完成设置和配置，您就可以测试服务器的功能：

-   **使用服务器工具：** Cline 会在您的服务器中创建各种“工具”，代表操作或数据获取功能。为了测试，您可以指示 Cline 使用特定工具。以下是与 GitHub 相关的示例：
    -   **`get_issues`：** 要测试获取问题，您可以对 Cline 说：“Cline，使用 GitHub 助手服务器的 `get_issues` 工具，显示 'cline/cline' 仓库中的开放问题。”Cline 随后会执行此工具并向您展示结果。
    -   **`get_pull_requests`：** 要测试拉取请求的获取，您可以要求 Cline “使用 `get_pull_requests` 工具，显示 'facebook/react' 仓库过去一个月的已合并拉取请求。”Cline 会执行此工具，使用您的 `GITHUB_TOKEN` 访问 GitHub API，并显示请求的数据。\
-   **提供必要信息：** Cline 可能会提示您提供执行工具所需的额外信息，例如仓库名称、具体日期范围或其他筛选条件。
-   **Cline 执行工具：** Cline 会处理与 GitHub API 的通信，获取请求的数据，并以清晰易懂的格式呈现。

### 4. 优化服务器并添加更多功能

开发通常是迭代的。在使用 GitHub 助手服务器的过程中，您会发现需要添加新功能或改进现有功能。Cline 可以协助您进行这一持续的过程：

-   **与 Cline 讨论：** 与 Cline 讨论您对新工具或改进的想法。例如，您可能希望有一个工具来 `create_issue` 或 `get_user_profile`。与 Cline 讨论这些工具所需的输入和输出。
-   **代码优化：** Cline 可以帮助您编写新功能所需的代码。Cline 可以生成代码片段、建议最佳实践，并帮助您调试出现的问题。
-   **测试新功能：** 在添加新工具或功能后，您可以再次使用 Cline 进行测试，确保它们按预期工作并与服务器的其他部分良好集成。
-   **与其他工具集成：** 您可能希望将 GitHub 助手服务器与其他工具集成。例如，在“github-cline-mcp”源代码中，Cline 协助将服务器与 Notion 集成，以创建一个动态仪表板，追踪 GitHub 活动。
通过遵循这些步骤，您可以使用 Cline 从头开始创建一个自定义 MCP 服务器，利用其强大的 AI 功能来简化整个过程。Cline 不仅在构建服务器的技术方面提供帮助，还能帮助您思考设计、功能以及可能的集成。